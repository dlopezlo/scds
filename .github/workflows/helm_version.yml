name: Inc Helm Version

on:
  workflow_dispatch: 
  push:
    branches:
      - main
    paths-ignore:
      - 'devops/k8s/helm/scds/Chart.yaml'

jobs:
  build:

    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
      # This is used to complete the identity challenge
      # with sigstore/fulcio when running outside of PRs.
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: current_version
        run: echo "current_version=$(grep 'version:' devops/k8s/helm/scds/Chart.yaml | cut -d ' ' -f2)" >> $GITHUB_ENV
      - name: FragileTech/bump-version
        uses: FragileTech/bump-version@main
        with:
          current_version: "${{ env.current_version }}"
          files: /devops/k8s/helm/scds/Chart.yaml
          commit_name: Bump Helm Chart Version
          commit_email: dlopezlo@gmail.com
          login: dlopezlo
          token: "${{ secrets.GHA_TOKEN_COMMIT }}"
